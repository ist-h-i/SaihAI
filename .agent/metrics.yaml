metrics:
  # 共通：これで全体劣化を防ぐ
  global:
    - id: "policy_violations"
      desc: "ruleset違反数（禁則・危険操作）"
      target: "minimize"
    - id: "patch_size"
      desc: "変更規模（ファイル数・行数）"
      target: "minimize"
    - id: "explainability"
      desc: "意図・根拠・リスクが明示されているか"
      target: "maximize"
    - id: "test_coverage_intent"
      desc: "テスト方針（自動/手動）が明示され、観測点があるか"
      target: "maximize"
  # 差分：スタック/現場で上書き
  scoped:
    - id: "stack_specific_rules"
      desc: "スタック固有の規約準拠（例：Angular/React/Spring）"
      target: "maximize"

promotion_gate:
  # 昇格（全社還元）判定の最低条件
  must_pass:
    - "global_non_regression"    # 共通ベンチで劣化しない
    - "scope_improvement"        # 該当スコープで改善
    - "complexity_budget"        # 指示肥大化していない
  complexity_budget:
    max_rules_added: 20
    max_template_growth_lines: 120

#
# オプション: レーダーチャート用に複数次元スコアを定義する例。
# 必要に応じて weights や正規化方法を変更してください。
dimensions:
  safety:
    desc: "禁則違反や危険操作の有無"
    metric: "policy_violations"
    direction: "negative" # 小さいほど良い
    weight: 0.25
  change_risk:
    desc: "変更規模（ファイル数・行数）と影響範囲"
    metric: "patch_size"
    direction: "negative"
    weight: 0.2
  explainability:
    desc: "説明責任テンプレの充足度"
    metric: "explainability"
    direction: "positive"
    weight: 0.2
  verification:
    desc: "テスト方針・観測点の明示とゲート実行状況"
    metric: "test_coverage_intent"
    direction: "positive"
    weight: 0.2
  maintainability:
    desc: "責務分離や設計の健全性、レビュー観点のカバー率"
    metric: "stack_specific_rules"
    direction: "positive"
    weight: 0.15

guardrails:
  # 禁則違反が 0 でなければ失格
  policy_violations:
    threshold: 0
    action: "fail"