# 🛠️ SaihAI v2.0 技術スタック・選定理由一覧

## 1. オーケストレーション（AIの頭脳）

| 項目 | 内容 |
| --- | --- |
| 技術名 | LangGraph (Python) |
| 使い方 | 「軍師・HR・PM・Risk」の4つのエージェント間の会話フロー制御、および人間による承認（Human-in-the-loop）の実装。 |
| 採用理由 | 「循環（Loop）」と「永続化（Persistence）」が必要だからです。一方通行の処理（LangChain）ではなく、納得いくまで議論を繰り返すループ処理や、人間の承認が降りるまで処理を数日間「待機」させる機能は、LangGraphでしか実現できません。 |

### 🧐 想定Q&A

- **Q:** なぜ普通のLangChainやDifyを使わないのですか？
- **A:** AIが一度出した答えを人間にレビューさせ、修正指示を出して「手戻り」させるフローが必要だからです。ステート（状態）をDBに保存してプロセスを一時停止できるLangGraphが必須でした。

## 2. データベース（AIの記憶）

| 項目 | 内容 |
| --- | --- |
| 技術名 | Amazon Aurora PostgreSQL + pgvector |
| 使い方 | 社員マスタ・勤怠データ（構造化データ）と、週報・面談ログのベクトルデータ（非構造化データ）を単一のDBで管理。 |
| 採用理由 | 「ハイブリッド検索」と「セキュリティ」のためです。「予算内（SQL）」かつ「モチベーション低下中（Vector）」という複合条件を高速に検索するには、データが同じ場所にあるのがベストです。また、人事データを外部のVector DBサービスに出さないことでセキュリティを担保しました。 |

テーブル定義: `docs/db-idea.md`

### 🧐 想定Q&A

- **Q:** Pineconeなどの専用DBの方が楽ではありませんか？
- **A:** 開発効率は良いですが、本番導入を想定すると「人事データ」のガバナンスが課題になります。既存のRDB基盤（Aurora）に統合する方が、企業ユースケースとしての現実性が高いと判断しました。

## 3. バックエンド（計算・処理基盤）

| 項目 | 内容 |
| --- | --- |
| 技術名 | FastAPI on Amazon ECS (Fargate) |
| 使い方 | LangGraphの実行環境および、Slack/フロントエンドとのAPI通信。 |
| 採用理由 | 「実行時間」と「非同期処理」です。AIエージェントの思考プロセスは数分かかる場合があり、Lambda（15分制限）ではタイムアウトのリスクがあります。また、FastAPIはWebSocketや非同期通信に強く、リアルタイムなログ出力に向いています。 |

### 🧐 想定Q&A

- **Q:** サーバーレス（Lambda）の方が安くないですか？
- **A:** 「Shadow Monitoring（常時監視）」や複雑な推論を行うSaihAIの特性上、コンテナを常駐させた方が応答速度が安定し、かつLangGraphのメモリ状態を維持しやすいメリットがあります。

## 4. トリガー＆非同期処理（自律神経）

| 項目 | 内容 |
| --- | --- |
| 技術名 | Amazon EventBridge + Amazon SQS |
| 使い方 | 夜間や定期的に「Watchdog」イベントを発火させ、全社員のログ解析ジョブをキュー（行列）に積む。 |
| 採用理由 | 「能動的なAI」を実現するためです。ユーザーのログインを待つのではなく、システム側から自律的に起動するトリガーとして採用しました。SQSを挟むことで、大量のログ解析が集中してもサーバーがダウンしないように制御しています。 |

### 🧐 想定Q&A

- **Q:** 全社員分のログを監視すると負荷が高すぎませんか？
- **A:** そのためにSQS（キュー）を導入しています。解析処理を分散させ、サーバーリソースに合わせて順次処理することで、システムへの過負荷を防いでいます。

## 5. フロントエンド（操作画面）

| 項目 | 内容 |
| --- | --- |
| 技術名 | Angular (on S3 + CloudFront) |
| 使い方 | マネージャーがAIの提案を確認し、詳細なデータ（グラフ等）を見るためのダッシュボード。 |
| 採用理由 | 「エンタープライズ品質」です。TypeScriptによる型安全性が高く、堅牢な管理画面構築に向いています。（※もしReactで作る場合は、「開発速度とモダンなUIライブラリの豊富さを優先しました」と答えればOKです） |
